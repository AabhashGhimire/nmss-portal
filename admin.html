<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>NMSS Admin Panel</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <script src="https://cdn.tailwindcss.com"></script>

  <style>
    .input {
      width: 100%;
      border: 1px solid #ddd;
      padding: 10px;
      border-radius: 8px;
      margin-bottom: 10px;
    }
    .btn {
      width: 100%;
      background: #2563eb;
      color: white;
      padding: 10px;
      border-radius: 8px;
    }
  </style>
</head>

<body class="bg-gray-100">

<!-- TOP BAR (MOBILE) -->
<header class="bg-blue-700 text-white flex justify-between items-center px-4 py-3 md:hidden">
  <span class="font-semibold">NMSS Admin</span>
  <button onclick="toggleMenu()">â˜°</button>
</header>

<div class="flex min-h-screen">

  <!-- SIDEBAR -->
  <aside id="sidebar"
    class="bg-blue-700 text-white w-64 p-6 fixed md:static inset-y-0 left-0
           transform -translate-x-full md:translate-x-0 transition-transform z-50">

    <h2 class="font-bold text-lg mb-6">NMSS Admin</h2>

    <nav class="space-y-3 text-sm">
      <a href="#students">Students</a>
      <a href="#teachers">Teachers</a>
      <a href="#announcements">Announcements</a>
      <a href="#events">Events</a>
    </nav>

    <button onclick="logout()" class="mt-10 bg-red-600 w-full py-2 rounded">
      Logout
    </button>
  </aside>

  <!-- MAIN CONTENT -->
  <main class="flex-1 p-6 md:p-10 space-y-16">

    <!-- STUDENTS -->
    <section id="students">
      <h2 class="text-xl font-bold mb-4">Add Student</h2>

      <div class="bg-white p-4 rounded shadow max-w-md">
        <input id="studentName" class="input" placeholder="Student Name">
        <input id="studentRole" class="input" placeholder="Role (President, Member)">
        <button class="btn" onclick="addStudent()">Add Student</button>
      </div>

      <h3 class="font-semibold mt-6 mb-2">Manage Students</h3>
      <div id="studentsList" class="space-y-2 max-w-md"></div>
    </section>

    <!-- TEACHERS -->
    <section id="teachers">
      <h2 class="text-xl font-bold mb-4">Add Teacher</h2>

      <div class="bg-white p-4 rounded shadow max-w-md">
        <input id="teacherName" class="input" placeholder="Teacher Name">
        <input id="teacherSubject" class="input" placeholder="Subject">
        <input id="teacherPost" class="input" placeholder="Post (HOD / Teacher)">
        <button class="btn" onclick="addTeacher()">Add Teacher</button>
      </div>

      <h3 class="font-semibold mt-6 mb-2">Manage Teachers</h3>
      <div id="teachersList" class="space-y-2 max-w-md"></div>
    </section>

    <!-- ANNOUNCEMENTS -->
    <section id="announcements">
      <h2 class="text-xl font-bold mb-4">Add Announcement</h2>

      <div class="bg-white p-4 rounded shadow max-w-md">
        <input id="announceTitle" class="input" placeholder="Title">
        <textarea id="announceMessage" class="input" placeholder="Message"></textarea>
        <button class="btn" onclick="addAnnouncement()">Add Announcement</button>
      </div>

      <h3 class="font-semibold mt-6 mb-2">Manage Announcements</h3>
      <div id="announcementsList" class="space-y-2 max-w-md"></div>
    </section>

    <!-- EVENTS -->
    <section id="events">
      <h2 class="text-xl font-bold mb-4">Add Event</h2>

      <div class="bg-white p-4 rounded shadow max-w-md">
        <input id="eventName" class="input" placeholder="Event Name">
        <input id="eventDate" type="date" class="input">
        <button class="btn" onclick="addEvent()">Add Event</button>
      </div>
    </section>

  </main>
</div>

<!-- FIREBASE -->
<script type="module" src="JS/firebase.js"></script>

<script type="module">
  import { auth, db } from "./js/firebase.js";
  import { onAuthStateChanged, signOut } from
    "https://www.gstatic.com/firebasejs/12.7.0/firebase-auth.js";
  import {
    collection,
    addDoc,
    getDocs,
    deleteDoc,
    doc,
    serverTimestamp
  } from "https://www.gstatic.com/firebasejs/12.7.0/firebase-firestore.js";

  /* AUTH PROTECT */
  onAuthStateChanged(auth, user => {
    if (!user) location.href = "login.html";
  });

  window.logout = () =>
    signOut(auth).then(() => location.href = "login.html");

  window.toggleMenu = () =>
    document.getElementById("sidebar").classList.toggle("-translate-x-full");

  /* ---------- STUDENTS ---------- */
  window.addStudent = async () => {
    if (!studentName.value || !studentRole.value)
      return alert("Fill all fields");

    await addDoc(collection(db, "members"), {
      name: studentName.value,
      role: studentRole.value,
      createdAt: serverTimestamp()
    });

    studentName.value = studentRole.value = "";
    loadStudents();
  };

  async function loadStudents() {
    studentsList.innerHTML = "";
    const snap = await getDocs(collection(db, "members"));
    snap.forEach(d => {
      const s = d.data();
      studentsList.innerHTML += `
        <div class="flex justify-between items-center bg-white p-2 rounded shadow">
          <span>${s.name} (${s.role})</span>
          <button class="text-red-600 text-sm"
            onclick="deleteStudent('${d.id}')">Delete</button>
        </div>`;
    });
  }

  window.deleteStudent = async (id) => {
    if (!confirm("Delete student?")) return;
    await deleteDoc(doc(db, "members", id));
    loadStudents();
  };

  loadStudents();

  /* ---------- TEACHERS ---------- */
  window.addTeacher = async () => {
    if (!teacherName.value || !teacherSubject.value || !teacherPost.value)
      return alert("Fill all fields");

    await addDoc(collection(db, "teachers"), {
      name: teacherName.value,
      subject: teacherSubject.value,
      post: teacherPost.value,
      createdAt: serverTimestamp()
    });

    teacherName.value = teacherSubject.value = teacherPost.value = "";
    loadTeachers();
  };

  async function loadTeachers() {
    teachersList.innerHTML = "";
    const snap = await getDocs(collection(db, "teachers"));
    snap.forEach(d => {
      const t = d.data();
      teachersList.innerHTML += `
        <div class="flex justify-between items-center bg-white p-2 rounded shadow">
          <span>${t.name} (${t.subject})</span>
          <button class="text-red-600 text-sm"
            onclick="deleteTeacher('${d.id}')">Delete</button>
        </div>`;
    });
  }

  window.deleteTeacher = async (id) => {
    if (!confirm("Delete teacher?")) return;
    await deleteDoc(doc(db, "teachers", id));
    loadTeachers();
  };

  loadTeachers();

  /* ---------- ANNOUNCEMENTS ---------- */
  window.addAnnouncement = async () => {
    if (!announceTitle.value || !announceMessage.value)
      return alert("Fill all fields");

    await addDoc(collection(db, "announcements"), {
      title: announceTitle.value,
      message: announceMessage.value,
      createdAt: serverTimestamp()
    });

    announceTitle.value = announceMessage.value = "";
    loadAnnouncements();
  };

  async function loadAnnouncements() {
    announcementsList.innerHTML = "";
    const snap = await getDocs(collection(db, "announcements"));
    snap.forEach(d => {
      const a = d.data();
      announcementsList.innerHTML += `
        <div class="flex justify-between items-center bg-white p-2 rounded shadow">
          <span>${a.title}</span>
          <button class="text-red-600 text-sm"
            onclick="deleteAnnouncement('${d.id}')">Delete</button>
        </div>`;
    });
  }

  window.deleteAnnouncement = async (id) => {
    if (!confirm("Delete announcement?")) return;
    await deleteDoc(doc(db, "announcements", id));
    loadAnnouncements();
  };

  loadAnnouncements();

  /* ---------- EVENTS ---------- */
  window.addEvent = async () => {
    if (!eventName.value || !eventDate.value)
      return alert("Fill all fields");

    await addDoc(collection(db, "events"), {
      name: eventName.value,
      date: eventDate.value,
      createdAt: serverTimestamp()
    });

    eventName.value = eventDate.value = "";
  };
</script>

</body>
</html>
